{{ header }}{{ column_left }}
<div id="content">
	<div class="page-header">
		<div class="container-fluid">
			<div class="pull-right">
				<button type="submit" form="form-module" data-toggle="tooltip" title="{{ button_save }}" class="btn btn-primary">
					<i class="fa fa-save"></i>
				</button>
				<a href="{{ cancel }}" data-toggle="tooltip" title="{{ button_cancel }}" class="btn btn-default">
					<i class="fa fa-reply"></i>
				</a>
			</div>
			<h1>{{ heading_title }}</h1>
			<ul class="breadcrumb">
				{% for breadcrumb in breadcrumbs %}
					<li>
						<a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a>
					</li>
				{% endfor %}
			</ul>
		</div>
	</div>
	<div class="container-fluid">
		{% if error_warning %}
			<div class="alert alert-danger alert-dismissible">
				<i class="fa fa-exclamation-circle"></i>
				{{ error_warning }}
				<button type="button" class="close" data-dismiss="alert">&times;</button>
			</div>
		{% endif %}
		<div class="panel panel-default">
			<div class="panel-heading">
				<h3 class="panel-title">
					<i class="fa fa-pencil"></i>
					{{ text_edit }}</h3>
			</div>
			<div class="panel-body">
				<form action="{{ action }}" method="post" enctype="multipart/form-data" id="form-module" class="form-horizontal">
					<ul class="nav nav-tabs">
						<li class="nav-item active">
							<a href="#tab-setting" data-toggle="tab" class="nav-link">{{tab_setting}}
							</a>
						</li>

						<li class="nav-item">
							<a href="#tab-update" data-toggle="tab" class="nav-link">{{tab_upgrade}}</a>
						</li>
					</ul>
					<div class="tab-content">
						<div class="tab-pane active" id="tab-setting">
							<div class="form-group required">
								<label for="input-name" class="col-sm-2 control-label">{{ entry_name }}</label>
								<div class="col-sm-10">
									<input type="text" name="name" value="{{ name }}" placeholder="{{ entry_name }}" id="input-name" class="form-control"/>
									{% if error_name %}
										<div class="text-danger">{{ error_name }}</div>
									{% endif %}
								</div>
							</div>

							<div class="form-group">
								<div class="alert alert-info">{{help_heading}}</div>

								<label class="col-sm-2 control-label" for="app_name">{{ entry_heading }}</label>
								<div class="col-sm-10">
									<td class="text-left">
										{% for language in languages %}
											<div class="input-group">
												<span class="input-group-addon"><img src="language/{{ language.code }}/{{ language.code }}.png" title="{{ language.name }}"/></span>
												<input type="text" name="heading[{{ language.language_id }}]" value="{{ heading[language.language_id] }}" placeholder="" id="heading-{{language.language_id}}" class="form-control"/>
											</div>
											<div id="{{language.language_id}}">
												<a href="javascript:void(0)" id="[categoryName]" class="font12 left setalink" data-token="[categoryName]" onclick="insertToken(this)">Category Name</a>
												|
												<a href="javascript:void(0)" id="[manufacturerName]" class="font12 left setalink" data-token="[manufacturerName]" onclick="insertToken(this)">Manufacturer Name</a>

											</div>
										{% endfor %}
									</td>
								</div>
							</div>


							<div class="form-group">

								<label class="col-sm-2 control-label" for="app_name">زیرعنوان</label>
								<div class="col-sm-10">
									<td class="text-left">
										{% for language in languages %}
											<div class="input-group">
												<span class="input-group-addon"><img src="language/{{ language.code }}/{{ language.code }}.png" title="{{ language.name }}"/></span>
												<input type="text" name="sub_heading[{{ language.language_id }}]" value="{{ sub_heading[language.language_id] }}" placeholder="" id="heading-{{language.language_id}}" class="form-control"/>
											</div>
											
										{% endfor %}
									</td>
								</div>
							</div>

							<div class="form-group">
								<label class="col-sm-2 control-label" for="input-status">{{ entry_status }}</label>
								<div class="col-sm-10">
									<select name="status" id="input-status" class="form-control">
										{% if status %}
											<option value="1" selected="selected">{{ text_enabled }}</option>
											<option value="0">{{ text_disabled }}</option>
										{% else %}
											<option value="1">{{ text_enabled }}</option>
											<option value="0" selected="selected">{{ text_disabled }}</option>
										{% endif %}
									</select>
								</div>
							</div>

							<div class="form-group">
								<label class="col-sm-2 control-label" for="input-status">{{ entry_design }}</label>
								<div class="col-sm-10">
									<select name="design" id="input-status" class="form-control">
										{% if design=='1' %}
											<option value="1" selected="selected">{{ text_design_1 }}</option>
											<option value="2">{{ text_design_2 }}</option>
										{% else %}
											<option value="1">{{ text_design_1 }}</option>
											<option value="2" selected="selected">{{ text_design_2 }}</option>
										{% endif %}
									</select>
								</div>
							</div>

							<div class="form-group">
								<label class="col-sm-2 control-label" for="input-design2-random-fill">{{ entry_design2_random_fill }}</label>
								<div class="col-sm-10">
									<select name="design2_random_fill" id="input-design2-random-fill" class="form-control">
										{% if design2_random_fill %}
											<option value="1" selected="selected">{{ text_enabled }}</option>
											<option value="0">{{ text_disabled }}</option>
										{% else %}
											<option value="1">{{ text_enabled }}</option>
											<option value="0" selected="selected">{{ text_disabled }}</option>
										{% endif %}
									</select>
								</div>
							</div>

							<div class="form-group">
								<label class="col-sm-2 control-label" for="app_name">{{ entry_limit }}</label>
								<div class="col-sm-10">
									<input type="text" name="limit" value="{{ limit }}" placeholder="" id="input-name" class="form-control"/>
								</div>
							</div>

							<div class="form-group required">
								<label class="col-sm-2 control-label" for="app_name">{{ entry_width }}</label>
								<div class="col-sm-10">
									<input type="text" name="width" value="{{ width }}" placeholder="" id="input-name" class="form-control"/>
									{% if error_width %}
										<div class="text-danger">{{ error_width }}</div>
									{% endif %}
								</div>
							</div>

							<div class="form-group required">
								<label class="col-sm-2 control-label" for="app_name">{{ entry_height }}</label>
								<div class="col-sm-10">
									<input type="text" name="height" value="{{ height }}" placeholder="" id="input-name" class="form-control"/>
									{% if error_height %}
										<div class="text-danger">{{ error_height }}</div>
									{% endif %}
								</div>
							</div>

							<div class="form-group">
								<label class="col-sm-2 control-label" for="input-status">{{ entry_display_type }}</label>
								<div class="col-sm-10">
									<select name="display_type" id="input-status" class="form-control">
										{% if display_type == 'all_product' %}
											<option value="all_product" selected="selected">{{ text_type_all_product }}</option>
											<option value="by_manufacturer">{{ text_type_manufacturer }}</option>
											<option value="by_category">{{ text_type_category }}</option>

										{% elseif display_type == 'by_manufacturer' %}
											<option value="all_product">{{ text_type_all_product }}</option>
											<option value="by_manufacturer" selected="selected">{{ text_type_manufacturer }}</option>
											<option value="by_category">{{ text_type_category }}</option>
										{% else %}
											<option value="all_product">{{ text_type_all_product }}</option>
											<option value="by_manufacturer">{{ text_type_manufacturer }}</option>
											<option value="by_category" selected="selected">{{ text_type_category }}</option>
										{% endif %}
									</select>
								</div>
							</div>

							<div class="form-group">
								<label class="col-sm-2 control-label" for="input-sort">{{ entry_sort }}</label>
								<div class="col-sm-10">
									<select name="sort" id="input-sort" class="form-control">
										{% if sort == 'pd.name' %}
											<option value="pd.name" selected="selected">{{ text_sort_name }}</option>
											<option value="p.price">{{ text_sort_price }}</option>
											<option value="p.quantity">{{ text_sort_quantity }}</option>
											<option value="p.date_added">{{ text_sort_dateadded }}</option>

										{% elseif sort == 'p.price' %}
											<option value="pd.name">{{ text_sort_name }}</option>
											<option value="p.price" selected="selected">{{ text_sort_price }}</option>
											<option value="p.quantity">{{ text_sort_quantity }}</option>
											<option value="p.date_added">{{ text_sort_dateadded }}</option>

										{% elseif sort == 'p.quantity' %}
											<option value="pd.name">{{ text_sort_name }}</option>
											<option value="p.price">{{ text_sort_price }}</option>
											<option value="p.quantity" selected="selected">{{ text_sort_quantity }}</option>
											<option value="p.date_added">{{ text_sort_dateadded }}</option>
										{% else %}
											<option value="pd.name">{{ text_sort_name }}</option>
											<option value="p.price">{{ text_sort_price }}</option>
											<option value="p.qantity">{{ text_sort_quantity }}</option>
											<option value="p.date_added" selected="selected">{{ text_sort_dateadded }}</option>
										{% endif %}
									</select>
								</div>
							</div>

							<div class="form-group">
								<label class="col-sm-2 control-label" for="input-order-desc">{{ entry_order_by }}</label>
								<div class="col-sm-10">
									<select name="order" id="input-order-desc" class="form-control">
										{% if order=='ASC' %}
											<option value="ASC" selected="selected">{{ text_asc }}</option>
											<option value="DESC">{{ text_desc }}</option>
										{% else %}
											<option value="ASC">{{ text_asc }}</option>
											<option value="DESC" selected="selected">{{ text_desc }}</option>
										{% endif %}
									</select>
								</div>
							</div>

							<div class="form-group">
								<label class="col-sm-2 control-label" for="app_name">{{ entry_category_amount }}</label>
								<div class="col-sm-10">
									<input type="text" name="category_amount" value="{{ category_amount }}" placeholder="" id="input-name" class="form-control"/>
								</div>
							</div>
						</div>

						<div class="tab-pane" id="tab-update">
							<fieldset>
								<legend>{{ text_information }}</legend>
								<div class="row">
									<div class="col-lg-3 col-md-3 col-sm-6">
										<div class="tile tile-primary">
											<div class="lead">
												<div class="tile-heading">{{ text_current_version }}</div>
												<input type="hidden" name="module_websky_viewed_current_version" value="{{ current_version }}"/>
												<span class=" {% if upgrade %}text-danger{% endif %} tile-body">{{ current_version }}</span>
											</div>
										</div>
									</div>
									<div class="col-lg-3 col-md-3 col-sm-6">
										<div class="tile tile-primary">
											<div class="lead">
												<div class="tile-heading">{{ text_latest_version }}</div>
												<span class="tile-body">{{ latest_version }}</span>
											</div>
										</div>
									</div>
									<div class="col-lg-3 col-md-3 col-sm-6">
										<div class="tile tile-primary">
											<div class="lead">
												<div class="tile-heading">{{ text_date_added }}</div>
												<span class="tile-body">{{ date_added }}</span>
											</div>
										</div>
									</div>
								</div>
								<div class="tile tile-success">
									<div class="tile-heading">
										<strong>{{ text_change }}</strong>
										<br/>
										{{ log }}
									</div>
								</div>
							</fieldset>
							<fieldset>
								<legend>{{ text_status }}</legend>
								<div class="form-group">
									<label class="col-sm-2 control-label">{{ entry_progress }}</label>
									<div class="col-sm-10 control-label">
										<div class="progress">
											<div id="progress-bar" class="progress-bar" style="width: 0%;"></div>
										</div>
										<div id="progress-text"></div>
									</div>
								</div>
								<div class="input-group input-group-lg">
									<button type="button" id="button-upgrade" class="btn btn-warning btn-lg" {% if not upgrade %} disabled {% endif %}>
										<i class="fa-solid fa-level-up-alt"></i>
										{{ button_upgrade }}</button>
								</div>
							</fieldset>
						</div>
					</div>
				</div>
			</form>
		</div>
	</div>
</div>

 <script type="text/javascript">
   
 function insertToken(obj){
					var dataToken= $(obj).attr('data-token');
					var id = $(obj).parent().attr('id');
					insertAtCaret(dataToken,id);	
			}
			function insertAtCaret(textFeildValue,id) 
			   {
					var textObj = document.getElementById("heading-"+id);
					if (document.all) {
						if (textObj.createTextRange && textObj.caretPos) {
							var caretPos  = textObj.caretPos;
							caretPos.text = caretPos.text.charAt(caretPos.text.length - 1) == ' ' ? textFeildValue + ' ' : textFeildValue;
						}
						else {
							textObj.value = textObj.value + textFeildValue;
						}
					}
					else {
						if (textObj.setSelectionRange) {
							var rangeStart = textObj.selectionStart;
							var rangeEnd   = textObj.selectionEnd;
							var tempStr1   = textObj.value.substring(0, rangeStart);
							var tempStr2   = textObj.value.substring(rangeEnd);
				
							textObj.value  = tempStr1 + textFeildValue + tempStr2;
						}
						else {
							alert("This version of Mozilla based browser does not support setSelectionRange");
						}
					}
				}


	$('#button-upgrade').on('click', function () {
	          var element = this;	
	        $(element).button('loading');
	              
	        $('#progress').html('{{ text_download|escape('js') }}');
	        
	      $('.alert-dismissible').remove();
	      $('#progress-bar').css('width', '0%');
	      $('#progress-bar').removeClass('progress-bar-danger progress-bar-success');
	      $('#progress-text').html('');
	              
	              $.ajax({
	                    url: 'index.php?route=extension/module/websky_viewed/download&user_token={{ user_token }}&version={{ latest_version }}&extension_name=websky_viewed',
	                    dataType: 'json',
	                    success: function (json) {
	                      $('#input-upgrade').removeClass('is-valid is-invalid');
	              
	                      if (json['error']) {
	                        $('#input-upgrade').val(json['error']);
	                        $('#input-upgrade').addClass('is-invalid');
	              
	                        $(element).button('reset');
	                      }
	              
	                      if (json['text']) {
	                        $('#input-upgrade').val(json['text']);
	                      }
	              
	                      if (json['success']) {
	                        $('#input-upgrade').val(json['success']);
	                        $('#input-upgrade').addClass('is-valid');
	              
	                        $(element).button('reset');
	                        
	                      }
	                      if (json['next']) {
	                                      next(json['next'], 1);
	                                  }
	                      if (json['success']) {
	                      location.reload();
	                      }
	                      
	                    },
	                    error: function (xhr, ajaxOptions, thrownError) {
	                      console.log(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
	              
	                      $(element).button('reset');
	                    }
	                  });
	                //};
	              
	                //chain.attach(upgrade);
	              });
	
	
	  function next(url, i) {
	  i = i + 1;
	
	  $.ajax({
	    url: url,
	    dataType: 'json',
	    success: function(json) {
	      $('#progress-bar').css('width', (i * 25) + '%');
	      
	      if (json['error']) {
	        $('#progress-bar').addClass('progress-bar-danger');
	        $('#progress-text').html('<div class="text-danger">' + json['error'] + '</div>');
	      }
	
	      if (json['success']) {
	        $('#progress-bar').addClass('progress-bar-success');
	        $('#progress-text').html('<span class="text-success">' + json['success'] + '</span>');
	        
	      }
	      
	      if (json['text']) {
	        $('#progress-text').html(json['text']);
	      }
	      
	      if (json['next']) {
	        next(json['next'], i);
	      }
	      if (json['success']) {
	                      location.reload();
	                      }
	    },
	    error: function(xhr, ajaxOptions, thrownError) {
	      alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
	    }
	  });
	}

		$('#language a:first').tab('show');
		</script></div>{{ footer }}
